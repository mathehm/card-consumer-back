{
  "info": {
    "name": "Card Consumer API - Complete",
    "description": "Collection completa para testar a API de carteira digital com produtos e relatórios",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "Wallet Operations",
      "item": [
        {
          "name": "1. Registrar Nova Carteira",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"code\": 12345,\n  \"balance\": 100.50,\n  \"user\": {\n    \"name\": \"João Silva\",\n    \"phone\": \"(11) 99999-9999\"\n  }\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/wallet/register",
              "host": ["{{baseUrl}}"],
              "path": ["wallet", "register"]
            },
            "description": "Cria uma nova carteira com usuário. Operação com transação atômica."
          },
          "response": []
        },
        {
          "name": "2. Listar Carteiras (Paginação/Busca)",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/wallet?page=1&limit=10&search=&sortBy=createdAt_desc&status=all",
              "host": ["{{baseUrl}}"],
              "path": ["wallet"],
              "query": [
                {
                  "key": "page",
                  "value": "1",
                  "description": "Número da página (default: 1)"
                },
                {
                  "key": "limit",
                  "value": "10",
                  "description": "Itens por página (1-100, default: 10)"
                },
                {
                  "key": "search",
                  "value": "",
                  "description": "Buscar por código, nome ou telefone"
                },
                {
                  "key": "sortBy",
                  "value": "createdAt_desc",
                  "description": "Ordenação: balance_asc/desc, totalCredit_asc/desc, createdAt_asc/desc, userName_asc/desc, code_asc/desc"
                },
                {
                  "key": "status",
                  "value": "all",
                  "description": "Filtro por status: all, winner, eligible, ineligible"
                }
              ]
            },
            "description": "Lista carteiras com paginação, busca e ordenação. Inclui dados do usuário e status do sorteio."
          },
          "response": [
            {
              "name": "Listar Todas (Default)",
              "originalRequest": {
                "method": "GET",
                "header": [],
                "url": {
                  "raw": "{{baseUrl}}/wallet",
                  "host": ["{{baseUrl}}"],
                  "path": ["wallet"]
                }
              },
              "status": "OK",
              "code": 200,
              "_postman_previewlanguage": "json",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "cookie": [],
              "body": "{\n  \"data\": [\n    {\n      \"id\": \"abc123\",\n      \"code\": 12345,\n      \"balance\": 150.75,\n      \"totalCredit\": 200.00,\n      \"alreadyWinner\": false,\n      \"createdAt\": { \"_seconds\": 1640995200, \"_nanoseconds\": 0 },\n      \"lotteryStatus\": \"eligible\",\n      \"user\": {\n        \"name\": \"João Silva\",\n        \"phone\": \"(11) 99999-9999\"\n      }\n    }\n  ],\n  \"pagination\": {\n    \"page\": 1,\n    \"limit\": 10,\n    \"total\": 25,\n    \"totalPages\": 3,\n    \"hasNext\": true,\n    \"hasPrev\": false\n  },\n  \"filters\": {\n    \"search\": \"\",\n    \"sortBy\": \"createdAt_desc\",\n    \"status\": \"all\"\n  },\n  \"fromCache\": false\n}"
            },
            {
              "name": "Filtrar Apenas Elegíveis",
              "originalRequest": {
                "method": "GET",
                "header": [],
                "url": {
                  "raw": "{{baseUrl}}/wallet?status=eligible&sortBy=totalCredit_desc",
                  "host": ["{{baseUrl}}"],
                  "path": ["wallet"],
                  "query": [
                    {
                      "key": "status",
                      "value": "eligible"
                    },
                    {
                      "key": "sortBy",
                      "value": "totalCredit_desc"
                    }
                  ]
                }
              },
              "status": "OK",
              "code": 200,
              "_postman_previewlanguage": "json",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "cookie": [],
              "body": "{\n  \"data\": [\n    {\n      \"id\": \"xyz789\",\n      \"code\": 54321,\n      \"balance\": 50.00,\n      \"totalCredit\": 500.00,\n      \"alreadyWinner\": false,\n      \"lotteryStatus\": \"eligible\",\n      \"user\": {\n        \"name\": \"Maria Santos\",\n        \"phone\": \"(21) 98888-8888\"\n      }\n    }\n  ],\n  \"pagination\": {\n    \"page\": 1,\n    \"limit\": 10,\n    \"total\": 1,\n    \"totalPages\": 1,\n    \"hasNext\": false,\n    \"hasPrev\": false\n  },\n  \"filters\": {\n    \"search\": \"\",\n    \"sortBy\": \"totalCredit_desc\",\n    \"status\": \"eligible\"\n  },\n  \"fromCache\": false\n}"
            }
          ]
        },
        {
          "name": "3. Consultar Carteira",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/wallet/{{walletCode}}",
              "host": ["{{baseUrl}}"],
              "path": ["wallet", "{{walletCode}}"]
            },
            "description": "Consulta uma carteira pelo código, retorna saldo, dados do usuário e histórico de transações."
          },
          "response": []
        },
        {
          "name": "4. Adicionar Crédito",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"value\": 50.00\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/wallet/{{walletCode}}/credit",
              "host": ["{{baseUrl}}"],
              "path": ["wallet", "{{walletCode}}", "credit"]
            },
            "description": "Adiciona crédito à carteira. Operação com transação atômica (saldo + histórico)."
          },
          "response": []
        },
        {
          "name": "5. Débito com Produtos",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"items\": [\n    {\n      \"productId\": \"{{productId1}}\",\n      \"quantity\": 2\n    },\n    {\n      \"productId\": \"{{productId2}}\",\n      \"quantity\": 1\n    }\n  ]\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/wallet/{{walletCode}}/debit",
              "host": ["{{baseUrl}}"],
              "path": ["wallet", "{{walletCode}}", "debit"]
            },
            "description": "Realiza débito com produtos. Backend calcula valor total automaticamente."
          },
          "response": []
        },
        {
          "name": "6. Débito do Sistema",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"value\": 15.00\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/wallet/{{walletCode}}/debit",
              "host": ["{{baseUrl}}"],
              "path": ["wallet", "{{walletCode}}", "debit"]
            },
            "description": "Realiza débito do sistema (sem produtos) para casos especiais."
          },
          "response": []
        },
        {
          "name": "7. Transferir Saldo",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"toCode\": 67890,\n  \"value\": 30.00\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/wallet/{{walletCode}}/transfer",
              "host": ["{{baseUrl}}"],
              "path": ["wallet", "{{walletCode}}", "transfer"]
            },
            "description": "Transfere saldo entre carteiras. Operação com transação atômica."
          },
          "response": []
        },
        {
          "name": "8. Cancelar Transação",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"transactionId\": \"{{transactionId}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/wallet/{{walletCode}}/cancel-transaction",
              "host": ["{{baseUrl}}"],
              "path": ["wallet", "{{walletCode}}", "cancel-transaction"]
            },
            "description": "Cancela uma transação específica e reverte seus efeitos automaticamente."
          },
          "response": []
        },
        {
          "name": "9. Sortear Vencedor da Loteria",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"valorPorEntrada\": {{valorPorEntrada}}\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/wallet/lottery/draw",
              "host": ["{{baseUrl}}"],
              "path": ["wallet", "lottery", "draw"]
            },
            "description": "Realiza o sorteio da loteria. Cada R$ 50 de crédito = 1 entrada. Retorna o vencedor sorteado ou null se não há participantes válidos."
          },
          "response": []
        },
        {
          "name": "10. Marcar Carteira como Vencedora",
          "request": {
            "method": "POST",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/wallet/{{walletCode}}/mark-winner",
              "host": ["{{baseUrl}}"],
              "path": ["wallet", "{{walletCode}}", "mark-winner"]
            },
            "description": "Marca uma carteira como vencedora após confirmação de presença. Carteiras marcadas ficam inelegíveis para futuros sorteios."
          },
          "response": []
        },
        {
          "name": "11. Remover Carteira",
          "request": {
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/wallet/{{walletCode}}",
              "host": ["{{baseUrl}}"],
              "path": ["wallet", "{{walletCode}}"]
            },
            "description": "Remove completamente a carteira. Operação com transação atômica (carteira + usuário + transações)."
          },
          "response": []
        }
      ]
    },
    {
      "name": "Product Management",
      "item": [
        {
          "name": "1. Criar Produto",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Refrigerante\",\n  \"category\": \"Bebidas\",\n  \"currentPrice\": 5.0\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/products",
              "host": ["{{baseUrl}}"],
              "path": ["products"]
            },
            "description": "Cria um novo produto no sistema."
          },
          "response": []
        },
        {
          "name": "2. Listar Todos os Produtos",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/products",
              "host": ["{{baseUrl}}"],
              "path": ["products"]
            },
            "description": "Lista todos os produtos (ativos e inativos)."
          },
          "response": []
        },
        {
          "name": "3. Listar Produtos Ativos",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/products/active",
              "host": ["{{baseUrl}}"],
              "path": ["products", "active"]
            },
            "description": "Lista apenas produtos ativos (disponíveis para venda). ROTA MAIS USADA PELO FRONTEND."
          },
          "response": []
        },
        {
          "name": "4. Obter Produto por ID",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/products/{{productId}}",
              "host": ["{{baseUrl}}"],
              "path": ["products", "{{productId}}"]
            },
            "description": "Obtém detalhes de um produto específico."
          },
          "response": []
        },
        {
          "name": "5. Atualizar Produto",
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Refrigerante Premium\",\n  \"currentPrice\": 7.0\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/products/{{productId}}",
              "host": ["{{baseUrl}}"],
              "path": ["products", "{{productId}}"]
            },
            "description": "Atualiza dados do produto. Cache é invalidado automaticamente."
          },
          "response": []
        },
        {
          "name": "6. Remover Produto (Soft Delete)",
          "request": {
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/products/{{productId}}",
              "host": ["{{baseUrl}}"],
              "path": ["products", "{{productId}}"]
            },
            "description": "Remove produto (soft delete - marca como inativo). Vendas antigas continuam válidas."
          },
          "response": []
        },
        {
          "name": "7. Ativar Produto",
          "request": {
            "method": "POST",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/products/{{productId}}/activate",
              "host": ["{{baseUrl}}"],
              "path": ["products", "{{productId}}", "activate"]
            },
            "description": "Reativa um produto que foi removido (soft delete)."
          },
          "response": []
        }
      ]
    },
    {
      "name": "Sales Reports",
      "item": [
        {
          "name": "1. Vendas de Hoje",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/reports/sales-today",
              "host": ["{{baseUrl}}"],
              "path": ["reports", "sales-today"]
            },
            "description": "Relatório completo de vendas do dia atual com resumo por produto."
          },
          "response": []
        },
        {
          "name": "2. Histórico por Produto",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/reports/sales-by-product/{{productId}}",
              "host": ["{{baseUrl}}"],
              "path": ["reports", "sales-by-product", "{{productId}}"]
            },
            "description": "Histórico completo de vendas de um produto específico com diferentes preços."
          },
          "response": []
        },
        {
          "name": "3. Vendas por Período",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/reports/sales-by-period?startDate=2025-01-01&endDate=2025-01-31",
              "host": ["{{baseUrl}}"],
              "path": ["reports", "sales-by-period"],
              "query": [
                {
                  "key": "startDate",
                  "value": "2025-01-01",
                  "description": "Data inicial (YYYY-MM-DD)"
                },
                {
                  "key": "endDate",
                  "value": "2025-01-31",
                  "description": "Data final (YYYY-MM-DD)"
                }
              ]
            },
            "description": "Relatório de vendas em período específico com resumo por dia."
          },
          "response": []
        }
      ]
    },
    {
      "name": "Testes de Validação",
      "item": [
        {
          "name": "Teste: Carteira com Código Duplicado",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"code\": 12345,\n  \"balance\": 200,\n  \"user\": {\n    \"name\": \"Maria Santos\",\n    \"phone\": \"(11) 88888-8888\"\n  }\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/wallet/register",
              "host": ["{{baseUrl}}"],
              "path": ["wallet", "register"]
            },
            "description": "Tenta criar carteira com código já existente. Deve retornar erro."
          },
          "response": []
        },
        {
          "name": "Teste: Débito com Saldo Insuficiente",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"value\": 1000.00\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/wallet/{{walletCode}}/debit",
              "host": ["{{baseUrl}}"],
              "path": ["wallet", "{{walletCode}}", "debit"]
            },
            "description": "Tenta debitar valor maior que o saldo. Deve retornar erro de saldo insuficiente."
          },
          "response": []
        },
        {
          "name": "Teste: Produto Inexistente na Venda",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"items\": [\n    {\n      \"productId\": \"produto-inexistente\",\n      \"quantity\": 1\n    }\n  ]\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/wallet/{{walletCode}}/debit",
              "host": ["{{baseUrl}}"],
              "path": ["wallet", "{{walletCode}}", "debit"]
            },
            "description": "Tenta vender produto que não existe. Deve retornar erro."
          },
          "response": []
        },
        {
          "name": "Teste: Produto Inativo na Venda",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"items\": [\n    {\n      \"productId\": \"{{inactiveProductId}}\",\n      \"quantity\": 1\n    }\n  ]\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/wallet/{{walletCode}}/debit",
              "host": ["{{baseUrl}}"],
              "path": ["wallet", "{{walletCode}}", "debit"]
            },
            "description": "Tenta vender produto inativo. Deve retornar erro."
          },
          "response": []
        }
      ]
    },
    {
      "name": "Fluxo Completo de Teste",
      "item": [
        {
          "name": "1. Setup: Criar Produtos",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Refrigerante Teste\",\n  \"category\": \"Bebidas\",\n  \"currentPrice\": 5.0\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/products",
              "host": ["{{baseUrl}}"],
              "path": ["products"]
            },
            "description": "Primeiro: criar alguns produtos para teste"
          },
          "response": []
        },
        {
          "name": "2. Setup: Criar Carteira",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"code\": 98765,\n  \"balance\": 500.00,\n  \"user\": {\n    \"name\": \"Cliente Teste\",\n    \"phone\": \"(11) 12345-6789\"\n  }\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/wallet/register",
              "host": ["{{baseUrl}}"],
              "path": ["wallet", "register"]
            },
            "description": "Segundo: criar carteira com saldo"
          },
          "response": []
        },
        {
          "name": "3. Buscar Produtos Ativos",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/products/active",
              "host": ["{{baseUrl}}"],
              "path": ["products", "active"]
            },
            "description": "Terceiro: listar produtos disponíveis (copiar IDs para próximos testes)"
          },
          "response": []
        },
        {
          "name": "4. Fazer Venda com Produtos",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"items\": [\n    {\n      \"productId\": \"COLAR_ID_DO_PRODUTO_AQUI\",\n      \"quantity\": 3\n    }\n  ]\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/wallet/98765/debit",
              "host": ["{{baseUrl}}"],
              "path": ["wallet", "98765", "debit"]
            },
            "description": "Quarto: fazer venda (colar ID do produto da etapa anterior)"
          },
          "response": []
        },
        {
          "name": "5. Verificar Saldo Atualizado",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/wallet/98765",
              "host": ["{{baseUrl}}"],
              "path": ["wallet", "98765"]
            },
            "description": "Quinto: verificar se saldo foi debitado e transação registrada"
          },
          "response": []
        },
        {
          "name": "6. Ver Relatório de Hoje",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/reports/sales-today",
              "host": ["{{baseUrl}}"],
              "path": ["reports", "sales-today"]
            },
            "description": "Sexto: verificar se venda aparece no relatório"
          },
          "response": []
        }
      ]
    }
  ],
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:3000",
      "type": "string"
    },
    {
      "key": "walletCode",
      "value": "12345",
      "type": "string"
    },
    {
      "key": "productId",
      "value": "PRODUTO_ID_AQUI",
      "type": "string",
      "description": "ID do produto (obtido após criar produto)"
    },
    {
      "key": "productId1",
      "value": "PRODUTO1_ID_AQUI",
      "type": "string"
    },
    {
      "key": "productId2",
      "value": "PRODUTO2_ID_AQUI",
      "type": "string"
    },
    {
      "key": "transactionId",
      "value": "TRANSACTION_ID_AQUI",
      "type": "string",
      "description": "ID da transação (obtido após fazer débito/venda)"
    },
    {
      "key": "inactiveProductId",
      "value": "PRODUTO_INATIVO_ID_AQUI",
      "type": "string"
    }
  ]
}
